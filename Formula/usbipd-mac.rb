# typed: true
# frozen_string_literal: true

# This file was generated by Homebrew Releaser. DO NOT EDIT.
class UsbipdMac < Formula
  desc "Macos implementation of the usb/ip protocol"
  homepage "https://github.com/beriberikix/usbipd-mac"
  url "https://github.com/beriberikix/usbipd-mac/archive/refs/tags/v0.0.17.tar.gz"
  version "0.0.17"
  sha256 "343b939bdefc11538265aa7d4bfb3977880929d41b7e6353368d287b6c3513e8"

  depends_on :macos => :big_sur
  depends_on :xcode => ["13.0", :build]

  def install
    # Build configuration with System Extension support
    system "swift", "build", "--configuration", "release", "--disable-sandbox"
    
    # Build System Extension product separately
    system "swift", "build", "--configuration", "release", "--product", "USBIPDSystemExtension", "--disable-sandbox"
    
    # Install the main binary
    bin.install ".build/release/usbipd"
    
    # Install System Extension to Library/SystemExtensions
    system_ext_dir = prefix/"Library/SystemExtensions"
    system_ext_dir.mkpath
    system_ext_bundle = ".build/release/USBIPDSystemExtension.systemextension"
    system_ext_dir.install system_ext_bundle => "usbipd-mac.systemextension"
  end

  test do
    assert_match "USB/IP Daemon for macOS", shell_output("#{bin}/usbipd --version")
  end
end
